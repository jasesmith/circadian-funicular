!function(e,t,n){"use strict";e.module("app").directive("timeDial",["$timeout","$interval",function(i,a){var r=function(e){var t={};return e&&(t={t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,l:e.offsetLeft,w:e.offsetWidth,h:e.offsetHeight},t.cx=t.l+t.w/2,t.cy=t.t+t.h/2),t},c=function(e,t){var n=r(t),i=Math.atan2(e.clientY-n.cy,e.clientX-n.cx),a=Math.round(180*i/Math.PI);return a},o=function(t,n){e.element(t).css({transform:"rotate("+n+"deg)"})},m=function(e,t){var n=0,i=Math.PI+1/30*(e%360);return i=0>i?i+12:i,n=parseInt(i),"m"===t&&(n=parseInt(5*i)%60),n};return{restrict:"E",replace:!0,scope:{time:"=?",diameter:"=?",unit:"=?",mode:"@"},template:'<div class="time-dial barrel" ng-class="{\'active-touch\': touching, \'clock-mode\': mode == \'tell\'}" ng-style="size(unit)"><div class="lcd {{meridiem}}" ng-class="{\'toggled\': toggled}"><div class="seconds" ng-if="mode==\'tell\'">{{format(time)|date:\'ss\'}}</div><div class="time">{{format(time)|date:\'h\'}}<span>:</span>{{format(time)|date:\'mm\'}}</div><div class="meridiem">{{meridiem}}</div></div><div class="crown hour"><span beat="h"></span></div><div class="crown minute"><span beat="m"></span></div></div>',link:function(r,s){r.time||(r.time=t()),r.mode||(r.mode="set");var d=e.element(s[0].querySelector(".minute")),u=e.element(s[0].querySelector(".hour")),l=e.element(s[0].querySelector(".lcd")),f=function(e){e=e?e:r.time;var t=e.minutes(),n=e.hours();12===n&&0===t?r.meridiem="noon":0===n&&0===t?r.meridiem="midnight":r.meridiem=e.format("a")},p=function(e,t){e=e?e:r.time;var n=e.minutes(),i=e.hours(),a=6*n,c=30*i+.5*n;t&&"m"!==t||o(d,a),t&&"h"!==t||o(u,c),f(e)},v=function(){"am"===r.time.format("a")?r.time.add(12,"hours"):r.time.subtract(12,"hours"),f(r.time),r.toggled=!0,i(function(){r.toggled=!1},300),r.$apply()},h=function(e,t){var n=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,i=c(n[0],s[0]),a=m(i,t),o=r.time.hour();"m"===t&&(59===r.prevTick&&0===a?r.time.add(1,"hour"):0===r.prevTick&&59===a&&r.time.subtract(1,"hour"),r.time.minute(a)),"h"===t&&(a=o>11?a+12:a,11===r.prevTick&&0===a?a+=12:23===r.prevTick&&12===a?(r.time.add(1,"day"),a-=12):12===r.prevTick&&23===a?a-=12:0===r.prevTick&&11===a&&(r.time.subtract(1,"day"),a+=12),r.time.hour(a)),r.prevTick=a,p(),r.$apply()};r.format=function(e){return new Date(e)},r.size=function(e){return e=e?e:"vmin",{fontSize:r.diameter+e}},r.touching=!1;var g=new n(d[0]),w=new n(u[0]),y=new n(l[0],{}),T={direction:n.DIRECTION_ALL,threshold:0};g.get("pan").set(T),g.on("pan panend pancancel",function(e){var t="panend"===e.type||"pancancel"===e.type?!1:!0;r.touching=e.srcEvent&&e.srcEvent.changedTouches?t:!1,h(e,"m")}),w.get("pan").set(T),w.on("pan panend pancancel",function(e){var t="panend"===e.type||"pancancel"===e.type?!1:!0;r.touching=e.srcEvent&&e.srcEvent.changedTouches?t:!1,h(e,"h")}),y.on("tap",function(){v()}),r.$watch("time",function(e){p(e)}),"tell"===r.mode&&a(function(){r.time=t(),p(r.time)},500)}}}])}(window.angular,window.moment,window.Hammer);