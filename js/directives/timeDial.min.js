!function(e,t,n){"use strict";e.module("app").directive("timeDial",["$timeout","$interval",function(i,a){var c=function(e){var t={};return e&&(t={t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,l:e.offsetLeft,w:e.offsetWidth,h:e.offsetHeight},t.cx=t.l+t.w/2,t.cy=t.t+t.h/2),t},r=function(e,t){var n=c(t),i=Math.atan2(e.clientY-n.cy,e.clientX-n.cx),a=Math.round(180*i/Math.PI);return a},o=function(t,n){e.element(t).css({transform:"rotate("+n+"deg)"})},m=function(e,t){var n=0,i=Math.PI+1/30*(e%360);return i=0>i?i+12:i,n=parseInt(i),"m"===t&&(n=parseInt(5*i)%60),n};return{restrict:"E",replace:!0,scope:{time:"=?",diameter:"=?",unit:"=?",mode:"=?"},template:'<div class="time-dial barrel {{mode}}" ng-class="{\'active-touch\': touching}" ng-style="size(unit)"><div class="lcd {{meridiem}}" ng-class="{\'toggled\': toggled}"><div class="time" data-title="{{format(time)|date:\'h:mm\'}}">{{format(time)|date:\'h\'}}<span>:</span>{{format(time)|date:\'mm\'}}</div><div class="meridiem" data-title="{{meridiem}}">{{meridiem}}</div></div><div class="crown hour"><span beat="h"></span></div><div class="crown minute"><span beat="m"></span></div><div class="crown second"><span beat="s"></span></div></div>',link:function(c,s){c.time||(c.time=t()),c.mode||(c.mode="set");var d=e.element(s[0].querySelector(".minute")),u=e.element(s[0].querySelector(".hour")),l=e.element(s[0].querySelector(".second")),f=e.element(s[0].querySelector(".lcd")),p=function(e){e=e?e:c.time;var t=e.minutes(),n=e.hours();12===n&&0===t?c.meridiem="Noon":0===n&&0===t?c.meridiem="Midnight":c.meridiem=e.format("a")},h=function(e,t){e=e?e:c.time;var n=e.seconds(),i=e.minutes(),a=e.hours(),r=6*n,m=6*i,s=30*a+.5*i;t&&"m"!==t||o(d,m),t&&"h"!==t||o(u,s),o(l,r),p(e)},v=function(){"am"===c.time.format("a")?c.time.add(12,"hours"):c.time.subtract(12,"hours"),p(c.time),c.toggled=!0,i(function(){c.toggled=!1},300),c.$apply()},g=function(e,t){var n=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,i=r(n[0],s[0]),a=m(i,t),o=c.time.hour();"m"===t&&(59===c.prevTick&&0===a?c.time.add(1,"hour"):0===c.prevTick&&59===a&&c.time.subtract(1,"hour"),c.time.minute(a)),"h"===t&&(a=o>11?a+12:a,11===c.prevTick&&0===a?a+=12:23===c.prevTick&&12===a?(c.time.add(1,"day"),a-=12):12===c.prevTick&&23===a?a-=12:0===c.prevTick&&11===a&&(c.time.subtract(1,"day"),a+=12),c.time.hour(a)),c.prevTick=a,h(),c.$apply()};c.format=function(e){return new Date(e)},c.size=function(e){return e=e?e:"vmin",{fontSize:c.diameter+e}},c.touching=!1;var w=new n(d[0]),y=new n(u[0]),T=new n(f[0],{}),E={direction:n.DIRECTION_ALL,threshold:0};w.get("pan").set(E),w.on("pan panend pancancel",function(e){var t="panend"===e.type||"pancancel"===e.type?!1:!0;c.touching=e.srcEvent&&e.srcEvent.changedTouches?t:!1,g(e,"m")}),y.get("pan").set(E),y.on("pan panend pancancel",function(e){var t="panend"===e.type||"pancancel"===e.type?!1:!0;c.touching=e.srcEvent&&e.srcEvent.changedTouches?t:!1,g(e,"h")}),T.on("tap",function(){v()});var b=null,k=function(){b=a(function(){c.time=t(),h(c.time)},1e3)},I=function(){e.isDefined(b)&&a.cancel(b)};c.$watch("mode",function(e){"tell"===e?k():I()}),c.$watch("time",function(e){h(e)})}}}])}(window.angular,window.moment,window.Hammer);