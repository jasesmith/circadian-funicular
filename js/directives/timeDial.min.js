!function(e,t){"use strict";e.module("app").directive("timeDial",["$interval",function(i){var n=function(e){var t={};return e&&(t={t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,l:e.offsetLeft,w:e.offsetWidth,h:e.offsetHeight},t.cx=t.l+t.w/2,t.cy=t.t+t.h/2),t},r=function(e,t){var i=n(t),r=Math.atan2(e.clientY-i.cy,e.clientX-i.cx),m=Math.round(180*r/Math.PI);return m},m=function(t,i){e.element(t).css({transform:"rotate("+i+"deg)"})},o=function(e,t){var i=0,n=Math.PI+1/30*(e%360);return n=0>n?n+12:n,i=parseInt(n),"m"===t&&(i=parseInt(5*n)%60),i};return{restrict:"E",replace:!0,scope:{time:"=?",diameter:"=?",unit:"=?",mode:"@"},template:'<div class="time-dial barrel" ng-class="{\'clock-mode\': mode == \'tell\'}" ng-style="size(unit)"><div class="lcd" hm-tap="toggleMeridiem()"><div class="seconds" ng-if="mode==\'tell\'">{{format(time)|date:\'ss\'}}</div><div class="time">{{format(time)|date:\'h\'}}<span>:</span>{{format(time)|date:\'mm\'}}</div><div class="meridiem">{{meridiem}}</div></div><div class="crown hour"><span hm-pan="setCrown($event, \'h\')"></span></div><div class="crown minute"><span hm-pan="setCrown($event, \'m\')"></span></div></div>',link:function(n,a){n.time||(n.time=t()),n.mode||(n.mode="set");var s=e.element(a[0].querySelector(".minute")),d=e.element(a[0].querySelector(".hour")),c=function(e){e=e?e:n.time;var t=e.minutes(),i=e.hours();12===i&&0===t?n.meridiem="noon":0===i&&0===t?n.meridiem="midnight":n.meridiem=e.format("a")},u=function(e,t){e=e?e:n.time;var i=e.minutes(),r=e.hours(),o=6*i,a=30*r+.5*i;t&&"m"!==t||m(s,o),t&&"h"!==t||m(d,a),c(e)};n.toggleMeridiem=function(){"am"===n.time.format("a")?n.time.add(12,"hours"):n.time.subtract(12,"hours"),c(n.time)},n.setCrown=function(e,t){var i=r(e.pointers[0],a[0]),m=o(i,t),s=n.time.hour();"m"===t&&(59===n.prevTick&&0===m?n.time.add(1,"hour"):0===n.prevTick&&59===m&&n.time.subtract(1,"hour"),n.time.minute(m)),"h"===t&&(m=s>11?m+12:m,11===n.prevTick&&0===m?m+=12:23===n.prevTick&&12===m?(n.time.add(1,"day"),m-=12):12===n.prevTick&&23===m?m-=12:0===n.prevTick&&11===m&&(n.time.subtract(1,"day"),m+=12),n.time.hour(m)),n.prevTick=m,u()},n.format=function(e){return new Date(e)},n.size=function(e){return e=e?e:"vmin",{fontSize:n.diameter+e}},u(),"tell"===n.mode&&i(function(){n.time=t(),u(n.time)},500)}}}])}(window.angular,window.moment);