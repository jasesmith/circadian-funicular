!function(e,t,n){"use strict";e.module("app").directive("timeDial",["$interval",function(i){var a=function(e){var t={};return e&&(t={t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,l:e.offsetLeft,w:e.offsetWidth,h:e.offsetHeight},t.cx=t.l+t.w/2,t.cy=t.t+t.h/2),t},r=function(e,t){var n=a(t),i=Math.atan2(e.clientY-n.cy,e.clientX-n.cx),r=Math.round(180*i/Math.PI);return r},c=function(t,n){e.element(t).css({transform:"rotate("+n+"deg)"})},o=function(e,t){var n=0,i=Math.PI+1/30*(e%360);return i=0>i?i+12:i,n=parseInt(i),"m"===t&&(n=parseInt(5*i)%60),n};return{restrict:"E",replace:!0,scope:{time:"=?",diameter:"=?",unit:"=?",mode:"@"},template:'<div class="time-dial barrel" ng-class="{\'active-touch\': touching, \'clock-mode\': mode == \'tell\'}" ng-style="size(unit)"><div class="lcd"><div class="seconds" ng-if="mode==\'tell\'">{{format(time)|date:\'ss\'}}</div><div class="time">{{format(time)|date:\'h\'}}<span>:</span>{{format(time)|date:\'mm\'}}</div><div class="meridiem">{{meridiem}}</div></div><div class="crown hour"><span></span></div><div class="crown minute"><span></span></div></div>',link:function(a,m){a.time||(a.time=t()),a.mode||(a.mode="set");var s=e.element(m[0].querySelector(".minute")),d=e.element(m[0].querySelector(".hour")),u=e.element(m[0].querySelector(".lcd")),f=function(e){e=e?e:a.time;var t=e.minutes(),n=e.hours();12===n&&0===t?a.meridiem="noon":0===n&&0===t?a.meridiem="midnight":a.meridiem=e.format("a")},l=function(e,t){e=e?e:a.time;var n=e.minutes(),i=e.hours(),r=6*n,o=30*i+.5*n;t&&"m"!==t||c(s,r),t&&"h"!==t||c(d,o),f(e)},p=function(){"am"===a.time.format("a")?a.time.add(12,"hours"):a.time.subtract(12,"hours"),f(a.time),a.$apply()},v=function(e,t){var n=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,i=r(n[0],m[0]),c=o(i,t),s=a.time.hour();"m"===t&&(59===a.prevTick&&0===c?a.time.add(1,"hour"):0===a.prevTick&&59===c&&a.time.subtract(1,"hour"),a.time.minute(c)),"h"===t&&(c=s>11?c+12:c,11===a.prevTick&&0===c?c+=12:23===a.prevTick&&12===c?(a.time.add(1,"day"),c-=12):12===a.prevTick&&23===c?c-=12:0===a.prevTick&&11===c&&(a.time.subtract(1,"day"),c+=12),a.time.hour(c)),a.prevTick=c,l(),a.$apply()};a.format=function(e){return new Date(e)},a.size=function(e){return e=e?e:"vmin",{fontSize:a.diameter+e}},a.touching=!1;var h=new n(s[0]),g=new n(d[0]),w=new n(u[0],{}),y={direction:n.DIRECTION_ALL,threshold:0};h.get("pan").set(y),h.on("pan panend pancancel",function(e){var t="panend"===e.type||"pancancel"===e.type?!1:!0;a.touching=e.srcEvent&&e.srcEvent.changedTouches?t:!1,v(e,"m")}),g.get("pan").set(y),g.on("pan panend pancancel",function(e){var t="panend"===e.type||"pancancel"===e.type?!1:!0;a.touching=e.srcEvent&&e.srcEvent.changedTouches?t:!1,v(e,"h")}),w.on("tap",function(){p()}),a.$watch("time",function(e){l(e)}),"tell"===a.mode&&i(function(){a.time=t(),l(a.time)},500)}}}])}(window.angular,window.moment,window.Hammer);